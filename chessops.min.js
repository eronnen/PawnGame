var Ft=Object.defineProperty;var G=(t,e)=>{for(var r in e)Ft(t,r,{get:e[r],enumerable:!0})};var K=["a","b","c","d","e","f","g","h"],Z=["1","2","3","4","5","6","7","8"],b=["white","black"],q=["pawn","knight","bishop","rook","queen","king"],Ee=["a","h"],P=t=>"role"in t,Ze=t=>"from"in t,zt=["chess","antichess","kingofthehill","3check","atomic","horde","racingkings","crazyhouse"];var h=t=>t!==void 0,d=t=>t==="white"?"black":"white",R=t=>t>>3,w=t=>t&7,ue=(t,e)=>0<=t&&t<8&&0<=e&&e<8?t+8*e:void 0,N=t=>{switch(t){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}};function T(t){switch(t.toLowerCase()){case"p":return"pawn";case"n":return"knight";case"b":return"bishop";case"r":return"rook";case"q":return"queen";case"k":return"king";default:return}}function M(t){if(t.length===2)return ue(t.charCodeAt(0)-"a".charCodeAt(0),t.charCodeAt(1)-"1".charCodeAt(0))}var g=t=>K[w(t)]+Z[R(t)],Dt=t=>{if(t[1]==="@"&&t.length===4){let e=T(t[0]),r=M(t.slice(2));if(e&&h(r))return{role:e,to:r}}else if(t.length===4||t.length===5){let e=M(t.slice(0,2)),r=M(t.slice(2,4)),n;if(t.length===5&&(n=T(t[4]),!n))return;if(h(e)&&h(r))return{from:e,to:r,promotion:n}}};var he=t=>P(t)?`${N(t.role).toUpperCase()}@${g(t.to)}`:g(t.from)+g(t.to)+(t.promotion?N(t.promotion):""),J=(t,e)=>t==="white"?e==="a"?2:6:e==="a"?58:62,le=(t,e)=>t==="white"?e==="a"?3:5:e==="a"?59:61;var Je=t=>(t=t-(t>>>1&1431655765),t=(t&858993459)+(t>>>2&858993459),Math.imul(t+(t>>>4)&252645135,16843009)>>24),Pe=t=>(t=t>>>8&16711935|(t&16711935)<<8,t>>>16&65535|(t&65535)<<16),Xe=t=>(t=t>>>1&1431655765|(t&1431655765)<<1,t=t>>>2&858993459|(t&858993459)<<2,t=t>>>4&252645135|(t&252645135)<<4,Pe(t)),o=class t{constructor(e,r){this.lo=e|0,this.hi=r|0}static fromSquare(e){return e>=32?new t(0,1<<e-32):new t(1<<e,0)}static fromRank(e){return new t(255,0).shl64(8*e)}static fromFile(e){return new t(16843009<<e,16843009<<e)}static empty(){return new t(0,0)}static full(){return new t(4294967295,4294967295)}static corners(){return new t(129,2164260864)}static center(){return new t(402653184,24)}static backranks(){return new t(255,4278190080)}static backrank(e){return e==="white"?new t(255,0):new t(0,4278190080)}static lightSquares(){return new t(1437226410,1437226410)}static darkSquares(){return new t(2857740885,2857740885)}complement(){return new t(~this.lo,~this.hi)}xor(e){return new t(this.lo^e.lo,this.hi^e.hi)}union(e){return new t(this.lo|e.lo,this.hi|e.hi)}intersect(e){return new t(this.lo&e.lo,this.hi&e.hi)}diff(e){return new t(this.lo&~e.lo,this.hi&~e.hi)}intersects(e){return this.intersect(e).nonEmpty()}isDisjoint(e){return this.intersect(e).isEmpty()}supersetOf(e){return e.diff(this).isEmpty()}subsetOf(e){return this.diff(e).isEmpty()}shr64(e){return e>=64?t.empty():e>=32?new t(this.hi>>>e-32,0):e>0?new t(this.lo>>>e^this.hi<<32-e,this.hi>>>e):this}shl64(e){return e>=64?t.empty():e>=32?new t(0,this.lo<<e-32):e>0?new t(this.lo<<e,this.hi<<e^this.lo>>>32-e):this}bswap64(){return new t(Pe(this.hi),Pe(this.lo))}rbit64(){return new t(Xe(this.hi),Xe(this.lo))}minus64(e){let r=this.lo-e.lo,n=(r&e.lo&1)+(e.lo>>>1)+(r>>>1)>>>31;return new t(r,this.hi-(e.hi+n))}equals(e){return this.lo===e.lo&&this.hi===e.hi}size(){return Je(this.lo)+Je(this.hi)}isEmpty(){return this.lo===0&&this.hi===0}nonEmpty(){return this.lo!==0||this.hi!==0}has(e){return(e>=32?this.hi&1<<e-32:this.lo&1<<e)!==0}set(e,r){return r?this.with(e):this.without(e)}with(e){return e>=32?new t(this.lo,this.hi|1<<e-32):new t(this.lo|1<<e,this.hi)}without(e){return e>=32?new t(this.lo,this.hi&~(1<<e-32)):new t(this.lo&~(1<<e),this.hi)}toggle(e){return e>=32?new t(this.lo,this.hi^1<<e-32):new t(this.lo^1<<e,this.hi)}last(){if(this.hi!==0)return 63-Math.clz32(this.hi);if(this.lo!==0)return 31-Math.clz32(this.lo)}first(){if(this.lo!==0)return 31-Math.clz32(this.lo&-this.lo);if(this.hi!==0)return 63-Math.clz32(this.hi&-this.hi)}withoutFirst(){return this.lo!==0?new t(this.lo&this.lo-1,this.hi):new t(0,this.hi&this.hi-1)}moreThanOne(){return this.hi!==0&&this.lo!==0||(this.lo&this.lo-1)!==0||(this.hi&this.hi-1)!==0}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let e=this.lo,r=this.hi;for(;e!==0;){let n=31-Math.clz32(e&-e);e^=1<<n,yield n}for(;r!==0;){let n=31-Math.clz32(r&-r);r^=1<<n,yield 32+n}}*reversed(){let e=this.lo,r=this.hi;for(;r!==0;){let n=31-Math.clz32(r);r^=1<<n,yield 32+n}for(;e!==0;){let n=31-Math.clz32(e);e^=1<<n,yield n}}};var fe=(t,e)=>{let r=o.empty();for(let n of e){let i=t+n;0<=i&&i<64&&Math.abs(w(t)-w(i))<=2&&(r=r.with(i))}return r},L=t=>{let e=[];for(let r=0;r<64;r++)e[r]=t(r);return e},Kt=L(t=>fe(t,[-9,-8,-7,-1,1,7,8,9])),Lt=L(t=>fe(t,[-17,-15,-10,-6,6,10,15,17])),Ut={white:L(t=>fe(t,[7,9])),black:L(t=>fe(t,[-7,-9]))},A=t=>Kt[t],V=t=>Lt[t],I=(t,e)=>Ut[t][e],Me=L(t=>o.fromFile(w(t)).without(t)),ve=L(t=>o.fromRank(R(t)).without(t)),Oe=L(t=>{let e=new o(134480385,2151686160),r=8*(R(t)-w(t));return(r>=0?e.shl64(r):e.shr64(-r)).without(t)}),Ae=L(t=>{let e=new o(270549120,16909320),r=8*(R(t)+w(t)-7);return(r>=0?e.shl64(r):e.shr64(-r)).without(t)}),Ne=(t,e,r)=>{let n=r.intersect(e),i=n.bswap64();return n=n.minus64(t),i=i.minus64(t.bswap64()),n.xor(i.bswap64()).intersect(e)},Gt=(t,e)=>Ne(o.fromSquare(t),Me[t],e),Vt=(t,e)=>{let r=ve[t],n=e.intersect(r),i=n.rbit64();return n=n.minus64(o.fromSquare(t)),i=i.minus64(o.fromSquare(63-t)),n.xor(i.rbit64()).intersect(r)},_=(t,e)=>{let r=o.fromSquare(t);return Ne(r,Oe[t],e).xor(Ne(r,Ae[t],e))},F=(t,e)=>Gt(t,e).xor(Vt(t,e)),H=(t,e)=>_(t,e).xor(F(t,e)),X=(t,e,r)=>{switch(t.role){case"pawn":return I(t.color,e);case"knight":return V(e);case"bishop":return _(e,r);case"rook":return F(e,r);case"queen":return H(e,r);case"king":return A(e)}},ee=(t,e)=>{let r=o.fromSquare(e);return ve[t].intersects(r)?ve[t].with(t):Ae[t].intersects(r)?Ae[t].with(t):Oe[t].intersects(r)?Oe[t].with(t):Me[t].intersects(r)?Me[t].with(t):o.empty()},z=(t,e)=>ee(t,e).intersect(o.full().shl64(t).xor(o.full().shl64(e))).withoutFirst();var y=class t{constructor(){}static default(){let e=new t;return e.reset(),e}reset(){this.occupied=new o(65535,4294901760),this.promoted=o.empty(),this.white=new o(65535,0),this.black=new o(0,4294901760),this.pawn=new o(65280,16711680),this.knight=new o(66,1107296256),this.bishop=new o(36,603979776),this.rook=new o(129,2164260864),this.queen=new o(8,134217728),this.king=new o(16,268435456)}static empty(){let e=new t;return e.clear(),e}clear(){this.occupied=o.empty(),this.promoted=o.empty();for(let e of b)this[e]=o.empty();for(let e of q)this[e]=o.empty()}clone(){let e=new t;e.occupied=this.occupied,e.promoted=this.promoted;for(let r of b)e[r]=this[r];for(let r of q)e[r]=this[r];return e}getColor(e){if(this.white.has(e))return"white";if(this.black.has(e))return"black"}getRole(e){for(let r of q)if(this[r].has(e))return r}get(e){let r=this.getColor(e);if(!r)return;let n=this.getRole(e),i=this.promoted.has(e);return{color:r,role:n,promoted:i}}take(e){let r=this.get(e);return r&&(this.occupied=this.occupied.without(e),this[r.color]=this[r.color].without(e),this[r.role]=this[r.role].without(e),r.promoted&&(this.promoted=this.promoted.without(e))),r}set(e,r){let n=this.take(e);return this.occupied=this.occupied.with(e),this[r.color]=this[r.color].with(e),this[r.role]=this[r.role].with(e),r.promoted&&(this.promoted=this.promoted.with(e)),n}has(e){return this.occupied.has(e)}*[Symbol.iterator](){for(let e of this.occupied)yield[e,this.get(e)]}pieces(e,r){return this[e].intersect(this[r])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}kingOf(e){return this.pieces(e,"king").singleSquare()}},Be=(t,e)=>t.white.equals(e.white)&&t.promoted.equals(e.promoted)&&q.every(r=>t[r].equals(e[r]));var B=class t{constructor(){}static empty(){let e=new t;for(let r of q)e[r]=0;return e}static fromBoard(e,r){let n=new t;for(let i of q)n[i]=e.pieces(r,i).size();return n}clone(){let e=new t;for(let r of q)e[r]=this[r];return e}equals(e){return q.every(r=>this[r]===e[r])}add(e){let r=new t;for(let n of q)r[n]=this[n]+e[n];return r}nonEmpty(){return q.some(e=>this[e]>0)}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}size(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}},U=class t{constructor(e,r){this.white=e;this.black=r}static empty(){return new t(B.empty(),B.empty())}static fromBoard(e){return new t(B.fromBoard(e,"white"),B.fromBoard(e,"black"))}clone(){return new t(this.white.clone(),this.black.clone())}equals(e){return this.white.equals(e.white)&&this.black.equals(e.black)}add(e){return new t(this.white.add(e.white),this.black.add(e.black))}count(e){return this.white[e]+this.black[e]}size(){return this.white.size()+this.black.size()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}},D=class t{constructor(e,r){this.white=e;this.black=r}static default(){return new t(3,3)}clone(){return new t(this.white,this.black)}equals(e){return this.white===e.white&&this.black===e.black}},$t=()=>({board:y.default(),pockets:void 0,turn:"white",castlingRights:o.corners(),epSquare:void 0,remainingChecks:void 0,halfmoves:0,fullmoves:1});var de=class{unwrap(e,r){let n=this._chain(i=>f.ok(e?e(i):i),i=>r?f.ok(r(i)):f.err(i));if(n.isErr)throw n.error;return n.value}map(e,r){return this._chain(n=>f.ok(e(n)),n=>f.err(r?r(n):n))}chain(e,r){return this._chain(e,r||(n=>f.err(n)))}},Te=class extends de{constructor(e){super(),this.value=void 0,this.isOk=!0,this.isErr=!1,this.value=e}_chain(e,r){return e(this.value)}},Ie=class extends de{constructor(e){super(),this.error=void 0,this.isOk=!1,this.isErr=!0,this.error=e}_chain(e,r){return r(this.error)}},f;(function(t){t.ok=function(e){return new Te(e)},t.err=function(e){return new Ie(e||new Error)},t.all=function(e){if(Array.isArray(e)){let i=[];for(let s=0;s<e.length;s++){let c=e[s];if(c.isErr)return c;i.push(c.value)}return t.ok(i)}let r={},n=Object.keys(e);for(let i=0;i<n.length;i++){let s=e[n[i]];if(s.isErr)return s;r[n[i]]=s.value}return t.ok(r)}})(f||(f={}));var te=(s=>(s.Empty="ERR_EMPTY",s.OppositeCheck="ERR_OPPOSITE_CHECK",s.PawnsOnBackrank="ERR_PAWNS_ON_BACKRANK",s.Kings="ERR_KINGS",s.Variant="ERR_VARIANT",s))(te||{}),m=class extends Error{},Ht=(t,e,r,n)=>r[e].intersect(F(t,n).intersect(r.rooksAndQueens()).union(_(t,n).intersect(r.bishopsAndQueens())).union(V(t).intersect(r.knight)).union(A(t).intersect(r.king)).union(I(d(e),t).intersect(r.pawn))),v=class t{constructor(){}static default(){let e=new t;return e.castlingRights=o.corners(),e.rook={white:{a:0,h:7},black:{a:56,h:63}},e.path={white:{a:new o(14,0),h:new o(96,0)},black:{a:new o(0,234881024),h:new o(0,1610612736)}},e}static empty(){let e=new t;return e.castlingRights=o.empty(),e.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},e.path={white:{a:o.empty(),h:o.empty()},black:{a:o.empty(),h:o.empty()}},e}clone(){let e=new t;return e.castlingRights=this.castlingRights,e.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},e.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},e}add(e,r,n,i){let s=J(e,r),c=le(e,r);this.castlingRights=this.castlingRights.with(i),this.rook[e][r]=i,this.path[e][r]=z(i,c).with(c).union(z(n,s).with(s)).without(n).without(i)}static fromSetup(e){let r=t.empty(),n=e.castlingRights.intersect(e.board.rook);for(let i of b){let s=o.backrank(i),c=e.board.kingOf(i);if(!h(c)||!s.has(c))continue;let a=n.intersect(e.board[i]).intersect(s),l=a.first();h(l)&&l<c&&r.add(i,"a",c,l);let u=a.last();h(u)&&c<u&&r.add(i,"h",c,u)}return r}discardRook(e){if(this.castlingRights.has(e)){this.castlingRights=this.castlingRights.without(e);for(let r of b)for(let n of Ee)this.rook[r][n]===e&&(this.rook[r][n]=void 0)}}discardColor(e){this.castlingRights=this.castlingRights.diff(o.backrank(e)),this.rook[e].a=void 0,this.rook[e].h=void 0}},E=class{constructor(e){this.rules=e}reset(){this.board=y.default(),this.pockets=void 0,this.turn="white",this.castles=v.default(),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}setupUnchecked(e){this.board=e.board.clone(),this.board.promoted=o.empty(),this.pockets=void 0,this.turn=e.turn,this.castles=v.fromSetup(e),this.epSquare=Qt(this,e.epSquare),this.remainingChecks=void 0,this.halfmoves=e.halfmoves,this.fullmoves=e.fullmoves}kingAttackers(e,r,n){return Ht(e,r,this.board,n)}playCaptureAt(e,r){this.halfmoves=0,r.role==="rook"&&this.castles.discardRook(e),this.pockets&&this.pockets[d(r.color)][r.promoted?"pawn":r.role]++}ctx(){let e=this.isVariantEnd(),r=this.board.kingOf(this.turn);if(!h(r))return{king:r,blockers:o.empty(),checkers:o.empty(),variantEnd:e,mustCapture:!1};let n=F(r,o.empty()).intersect(this.board.rooksAndQueens()).union(_(r,o.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[d(this.turn)]),i=o.empty();for(let c of n){let a=z(r,c).intersect(this.board.occupied);a.moreThanOne()||(i=i.union(a))}let s=this.kingAttackers(r,d(this.turn),this.board.occupied);return{king:r,blockers:i,checkers:s,variantEnd:e,mustCapture:!1}}clone(){let e=new this.constructor;return e.board=this.board.clone(),e.pockets=this.pockets?.clone(),e.turn=this.turn,e.castles=this.castles.clone(),e.epSquare=this.epSquare,e.remainingChecks=this.remainingChecks?.clone(),e.halfmoves=this.halfmoves,e.fullmoves=this.fullmoves,e}validate(){if(this.board.occupied.isEmpty())return f.err(new m("ERR_EMPTY"));if(this.board.king.size()!==2)return f.err(new m("ERR_KINGS"));if(!h(this.board.kingOf(this.turn)))return f.err(new m("ERR_KINGS"));let e=this.board.kingOf(d(this.turn));return h(e)?this.kingAttackers(e,this.turn,this.board.occupied).nonEmpty()?f.err(new m("ERR_OPPOSITE_CHECK")):o.backranks().intersects(this.board.pawn)?f.err(new m("ERR_PAWNS_ON_BACKRANK")):f.ok(void 0):f.err(new m("ERR_KINGS"))}dropDests(e){return o.empty()}dests(e,r){if(r=r||this.ctx(),r.variantEnd)return o.empty();let n=this.board.get(e);if(!n||n.color!==this.turn)return o.empty();let i,s;if(n.role==="pawn"){i=I(this.turn,e).intersect(this.board[d(this.turn)]);let c=this.turn==="white"?8:-8,a=e+c;if(0<=a&&a<64&&!this.board.occupied.has(a)){i=i.with(a);let l=this.turn==="white"?e<16:e>=64-16,u=a+c;l&&!this.board.occupied.has(u)&&(i=i.with(u))}h(this.epSquare)&&jt(this,e,r)&&(s=o.fromSquare(this.epSquare))}else n.role==="bishop"?i=_(e,this.board.occupied):n.role==="knight"?i=V(e):n.role==="rook"?i=F(e,this.board.occupied):n.role==="queen"?i=H(e,this.board.occupied):i=A(e);if(i=i.diff(this.board[this.turn]),h(r.king)){if(n.role==="king"){let c=this.board.occupied.without(e);for(let a of i)this.kingAttackers(a,d(this.turn),c).nonEmpty()&&(i=i.without(a));return i.union(pe(this,"a",r)).union(pe(this,"h",r))}if(r.checkers.nonEmpty()){let c=r.checkers.singleSquare();if(!h(c))return o.empty();i=i.intersect(z(c,r.king).with(c))}r.blockers.has(e)&&(i=i.intersect(ee(e,r.king)))}return s&&(i=i.union(s)),i}isVariantEnd(){return!1}variantOutcome(e){}hasInsufficientMaterial(e){return this.board[e].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty()?!1:this.board[e].intersects(this.board.knight)?this.board[e].size()<=2&&this.board[d(e)].diff(this.board.king).diff(this.board.queen).isEmpty():this.board[e].intersects(this.board.bishop)?(!this.board.bishop.intersects(o.darkSquares())||!this.board.bishop.intersects(o.lightSquares()))&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty():!0}toSetup(){return{board:this.board.clone(),pockets:this.pockets?.clone(),turn:this.turn,castlingRights:this.castles.castlingRights,epSquare:_e(this),remainingChecks:this.remainingChecks?.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}isInsufficientMaterial(){return b.every(e=>this.hasInsufficientMaterial(e))}hasDests(e){e=e||this.ctx();for(let r of this.board[this.turn])if(this.dests(r,e).nonEmpty())return!0;return this.dropDests(e).nonEmpty()}isLegal(e,r){if(P(e))return!this.pockets||this.pockets[this.turn][e.role]<=0||e.role==="pawn"&&o.backranks().has(e.to)?!1:this.dropDests(r).has(e.to);{if(e.promotion==="pawn"||e.promotion==="king"&&this.rules!=="antichess"||!!e.promotion!==(this.board.pawn.has(e.from)&&o.backranks().has(e.to)))return!1;let n=this.dests(e.from,r);return n.has(e.to)||n.has(Fe(this,e).to)}}isCheck(){let e=this.board.kingOf(this.turn);return h(e)&&this.kingAttackers(e,d(this.turn),this.board.occupied).nonEmpty()}isEnd(e){return(e?e.variantEnd:this.isVariantEnd())?!0:this.isInsufficientMaterial()||!this.hasDests(e)}isCheckmate(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.nonEmpty()&&!this.hasDests(e)}isStalemate(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.isEmpty()&&!this.hasDests(e)}outcome(e){let r=this.variantOutcome(e);return r||(e=e||this.ctx(),this.isCheckmate(e)?{winner:d(this.turn)}:this.isInsufficientMaterial()||this.isStalemate(e)?{winner:void 0}:void 0)}allDests(e){e=e||this.ctx();let r=new Map;if(e.variantEnd)return r;for(let n of this.board[this.turn])r.set(n,this.dests(n,e));return r}play(e){let r=this.turn,n=this.epSquare,i=ke(this,e);if(this.epSquare=void 0,this.halfmoves+=1,r==="black"&&(this.fullmoves+=1),this.turn=d(r),P(e))this.board.set(e.to,{role:e.role,color:r}),this.pockets&&this.pockets[r][e.role]--,e.role==="pawn"&&(this.halfmoves=0);else{let s=this.board.take(e.from);if(!s)return;let c;if(s.role==="pawn"){this.halfmoves=0,e.to===n&&(c=this.board.take(e.to+(r==="white"?-8:8)));let a=e.from-e.to;Math.abs(a)===16&&8<=e.from&&e.from<=55&&(this.epSquare=e.from+e.to>>1),e.promotion&&(s.role=e.promotion,s.promoted=!!this.pockets)}else if(s.role==="rook")this.castles.discardRook(e.from);else if(s.role==="king"){if(i){let a=this.castles.rook[r][i];if(h(a)){let l=this.board.take(a);this.board.set(J(r,i),s),l&&this.board.set(le(r,i),l)}}this.castles.discardColor(r)}if(!i){let a=this.board.set(e.to,s)||c;a&&this.playCaptureAt(e.to,a)}}this.remainingChecks&&this.isCheck()&&(this.remainingChecks[r]=Math.max(this.remainingChecks[r]-1,0))}},$=class extends E{constructor(){super("chess")}static default(){let e=new this;return e.reset(),e}static fromSetup(e){let r=new this;return r.setupUnchecked(e),r.validate().map(n=>r)}clone(){return super.clone()}},Qt=(t,e)=>{if(!h(e))return;let r=t.turn==="white"?5:2,n=t.turn==="white"?8:-8;if(R(e)!==r||t.board.occupied.has(e+n))return;let i=e-n;if(!(!t.board.pawn.has(i)||!t.board[d(t.turn)].has(i)))return e},_e=t=>{if(!h(t.epSquare))return;let e=t.ctx(),n=t.board.pieces(t.turn,"pawn").intersect(I(d(t.turn),t.epSquare));for(let i of n)if(t.dests(i,e).has(t.epSquare))return t.epSquare},jt=(t,e,r)=>{if(!h(t.epSquare)||!I(t.turn,e).has(t.epSquare))return!1;if(!h(r.king))return!0;let n=t.turn==="white"?8:-8,i=t.epSquare-n;return t.kingAttackers(r.king,d(t.turn),t.board.occupied.toggle(e).toggle(i).with(t.epSquare)).without(i).isEmpty()},pe=(t,e,r)=>{if(!h(r.king)||r.checkers.nonEmpty())return o.empty();let n=t.castles.rook[t.turn][e];if(!h(n))return o.empty();if(t.castles.path[t.turn][e].intersects(t.board.occupied))return o.empty();let i=J(t.turn,e),s=z(r.king,i),c=t.board.occupied.without(r.king);for(let u of s)if(t.kingAttackers(u,d(t.turn),c).nonEmpty())return o.empty();let a=le(t.turn,e),l=t.board.occupied.toggle(r.king).toggle(n).toggle(a);return t.kingAttackers(i,d(t.turn),l).nonEmpty()?o.empty():o.fromSquare(n)},me=(t,e,r)=>{if(r.variantEnd)return o.empty();let n=t.board.get(e);if(!n||n.color!==t.turn)return o.empty();let i=X(n,e,t.board.occupied);if(n.role==="pawn"){let s=t.board[d(t.turn)];h(t.epSquare)&&(s=s.with(t.epSquare)),i=i.intersect(s);let c=t.turn==="white"?8:-8,a=e+c;if(0<=a&&a<64&&!t.board.occupied.has(a)){i=i.with(a);let l=t.turn==="white"?e<16:e>=64-16,u=a+c;l&&!t.board.occupied.has(u)&&(i=i.with(u))}return i}else i=i.diff(t.board[t.turn]);return e===r.king?i.union(pe(t,"a",r)).union(pe(t,"h",r)):i},et=(t,e)=>t.rules===e.rules&&Be(t.board,e.board)&&(e.pockets&&t.pockets?.equals(e.pockets)||!t.pockets&&!e.pockets)&&t.turn===e.turn&&t.castles.castlingRights.equals(e.castles.castlingRights)&&_e(t)===_e(e)&&(e.remainingChecks&&t.remainingChecks?.equals(e.remainingChecks)||!t.remainingChecks&&!e.remainingChecks),ke=(t,e)=>{if(P(e))return;let r=e.to-e.from;if(!(Math.abs(r)!==2&&!t.board[t.turn].has(e.to))&&t.board.king.has(e.from))return r>0?"h":"a"},Fe=(t,e)=>{let r=ke(t,e);if(!r)return e;let n=t.castles.rook[t.turn][r];return{from:e.from,to:h(n)?n:e.to}},ze=(t,e)=>{let r=Math.max(t.pieces(e,"queen").size()-1,0)+Math.max(t.pieces(e,"rook").size()-2,0)+Math.max(t.pieces(e,"knight").size()-2,0)+Math.max(t.pieces(e,"bishop").intersect(o.lightSquares()).size()-1,0)+Math.max(t.pieces(e,"bishop").intersect(o.darkSquares()).size()-1,0);return t.pieces(e,"pawn").size()+r<=8};var tt=t=>{let e=t.board.kingOf(t.turn);if(!h(e))return!1;let r=t.kingAttackers(e,d(t.turn),t.board.occupied);if(r.isEmpty())return!1;if(h(t.epSquare)){let n=t.epSquare^8,i=t.epSquare^24;return r.moreThanOne()||r.first()!==n&&t.kingAttackers(e,d(t.turn),t.board.occupied.without(n).with(i)).nonEmpty()}else return t.rules==="atomic"?!1:r.size()>2||r.size()===2&&ee(r.first(),r.last()).has(e)};var rt={};G(rt,{chessgroundDests:()=>Wt,chessgroundMove:()=>Yt,lichessRules:()=>Jt,lichessVariant:()=>Xt,scalachessCharPair:()=>Zt});var Wt=(t,e)=>{let r=new Map,n=t.ctx();for(let[i,s]of t.allDests(n))if(s.nonEmpty()){let c=Array.from(s,g);!e?.chess960&&i===n.king&&w(i)===4&&(s.has(0)?c.push("c1"):s.has(56)&&c.push("c8"),s.has(7)?c.push("g1"):s.has(63)&&c.push("g8")),r.set(g(i),c)}return r},Yt=t=>P(t)?[g(t.to)]:[g(t.from),g(t.to)],Zt=t=>P(t)?String.fromCharCode(35+t.to,35+64+8*5+["queen","rook","bishop","knight","pawn"].indexOf(t.role)):String.fromCharCode(35+t.from,t.promotion?35+64+8*["queen","rook","bishop","knight","king"].indexOf(t.promotion)+w(t.to):35+t.to),Jt=t=>{switch(t){case"standard":case"chess960":case"fromPosition":return"chess";case"threeCheck":return"3check";case"kingOfTheHill":return"kingofthehill";case"racingKings":return"racingkings";default:return t}},Xt=t=>{switch(t){case"chess":return"standard";case"3check":return"threeCheck";case"kingofthehill":return"kingOfTheHill";case"racingkings":return"racingKings";default:return t}};var kt={};G(kt,{board:()=>sr,dests:()=>or,perft:()=>Ge,piece:()=>pt,square:()=>mt,squareSet:()=>ir});var dt={};G(dt,{EMPTY_BOARD_FEN:()=>st,EMPTY_EPD:()=>ot,EMPTY_FEN:()=>tr,FenError:()=>x,INITIAL_BOARD_FEN:()=>nt,INITIAL_EPD:()=>it,INITIAL_FEN:()=>er,InvalidFen:()=>at,makeBoardFen:()=>ut,makeCastlingFen:()=>lt,makeFen:()=>we,makePiece:()=>be,makePocket:()=>Le,makePockets:()=>ht,makeRemainingChecks:()=>ft,parseBoardFen:()=>Se,parseCastlingFen:()=>ct,parseFen:()=>ge,parsePiece:()=>nr,parsePockets:()=>De,parseRemainingChecks:()=>Ke});var nt="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",it=nt+" w KQkq -",er=it+" 0 1",st="8/8/8/8/8/8/8/8",ot=st+" w - -",tr=ot+" 0 1",at=(u=>(u.Fen="ERR_FEN",u.Board="ERR_BOARD",u.Pockets="ERR_POCKETS",u.Turn="ERR_TURN",u.Castling="ERR_CASTLING",u.EpSquare="ERR_EP_SQUARE",u.RemainingChecks="ERR_REMAINING_CHECKS",u.Halfmoves="ERR_HALFMOVES",u.Fullmoves="ERR_FULLMOVES",u))(at||{}),x=class extends Error{},rr=(t,e,r)=>{let n=t.indexOf(e);for(;r-- >0&&n!==-1;)n=t.indexOf(e,n+e.length);return n},Q=t=>/^\d{1,4}$/.test(t)?parseInt(t,10):void 0,Ue=t=>{let e=T(t);return e&&{role:e,color:t.toLowerCase()===t?"black":"white"}},Se=t=>{let e=y.empty(),r=7,n=0;for(let i=0;i<t.length;i++){let s=t[i];if(s==="/"&&n===8)n=0,r--;else{let c=parseInt(s,10);if(c>0)n+=c;else{if(n>=8||r<0)return f.err(new x("ERR_BOARD"));let a=n+r*8,l=Ue(s);if(!l)return f.err(new x("ERR_BOARD"));t[i+1]==="~"&&(l.promoted=!0,i++),e.set(a,l),n++}}}return r!==0||n!==8?f.err(new x("ERR_BOARD")):f.ok(e)},De=t=>{if(t.length>64)return f.err(new x("ERR_POCKETS"));let e=U.empty();for(let r of t){let n=Ue(r);if(!n)return f.err(new x("ERR_POCKETS"));e[n.color][n.role]++}return f.ok(e)},ct=(t,e)=>{let r=o.empty();if(e==="-")return f.ok(r);for(let n of e){let i=n.toLowerCase(),s=n===i?"black":"white",c=s==="white"?0:7;if("a"<=i&&i<="h")r=r.with(ue(i.charCodeAt(0)-"a".charCodeAt(0),c));else if(i==="k"||i==="q"){let a=t[s].intersect(o.backrank(s)).intersect(t.rook.union(t.king)),l=i==="k"?a.last():a.first();r=r.with(h(l)&&t.rook.has(l)?l:ue(i==="k"?7:0,c))}else return f.err(new x("ERR_CASTLING"))}return b.some(n=>o.backrank(n).intersect(r).size()>2)?f.err(new x("ERR_CASTLING")):f.ok(r)},Ke=t=>{let e=t.split("+");if(e.length===3&&e[0]===""){let r=Q(e[1]),n=Q(e[2]);return!h(r)||r>3||!h(n)||n>3?f.err(new x("ERR_REMAINING_CHECKS")):f.ok(new D(3-r,3-n))}else if(e.length===2){let r=Q(e[0]),n=Q(e[1]);return!h(r)||r>3||!h(n)||n>3?f.err(new x("ERR_REMAINING_CHECKS")):f.ok(new D(r,n))}else return f.err(new x("ERR_REMAINING_CHECKS"))},ge=t=>{let e=t.split(/[\s_]+/),r=e.shift(),n,i=f.ok(void 0);if(r.endsWith("]")){let a=r.indexOf("[");if(a===-1)return f.err(new x("ERR_FEN"));n=Se(r.slice(0,a)),i=De(r.slice(a+1,-1))}else{let a=rr(r,"/",7);a===-1?n=Se(r):(n=Se(r.slice(0,a)),i=De(r.slice(a+1)))}let s,c=e.shift();if(!h(c)||c==="w")s="white";else if(c==="b")s="black";else return f.err(new x("ERR_TURN"));return n.chain(a=>{let l=e.shift(),u=h(l)?ct(a,l):f.ok(o.empty()),p=e.shift(),S;if(h(p)&&p!=="-"&&(S=M(p),!h(S)))return f.err(new x("ERR_EP_SQUARE"));let C=e.shift(),k;h(C)&&C.includes("+")&&(k=Ke(C),C=e.shift());let O=h(C)?Q(C):0;if(!h(O))return f.err(new x("ERR_HALFMOVES"));let Y=e.shift(),We=h(Y)?Q(Y):1;if(!h(We))return f.err(new x("ERR_FULLMOVES"));let Ye=e.shift(),Re=f.ok(void 0);if(h(Ye)){if(h(k))return f.err(new x("ERR_REMAINING_CHECKS"));Re=Ke(Ye)}else h(k)&&(Re=k);return e.length>0?f.err(new x("ERR_FEN")):i.chain(Tt=>u.chain(It=>Re.map(_t=>({board:a,pockets:Tt,turn:s,castlingRights:It,remainingChecks:_t,epSquare:S,halfmoves:O,fullmoves:Math.max(1,We)}))))})},nr=t=>{if(!t)return;let e=Ue(t[0]);if(e){if(t.length===2&&t[1]==="~")e.promoted=!0;else if(t.length>1)return;return e}},be=t=>{let e=N(t.role);return t.color==="white"&&(e=e.toUpperCase()),t.promoted&&(e+="~"),e},ut=t=>{let e="",r=0;for(let n=7;n>=0;n--)for(let i=0;i<8;i++){let s=i+n*8,c=t.get(s);c?(r>0&&(e+=r,r=0),e+=be(c)):r++,i===7&&(r>0&&(e+=r,r=0),n!==0&&(e+="/"))}return e},Le=t=>q.map(e=>N(e).repeat(t[e])).join(""),ht=t=>Le(t.white).toUpperCase()+Le(t.black),lt=(t,e)=>{let r="";for(let n of b){let i=o.backrank(n),s=t.kingOf(n);h(s)&&!i.has(s)&&(s=void 0);let c=t.pieces(n,"rook").intersect(i);for(let a of e.intersect(i).reversed())if(a===c.first()&&h(s)&&a<s)r+=n==="white"?"Q":"q";else if(a===c.last()&&h(s)&&s<a)r+=n==="white"?"K":"k";else{let l=K[w(a)];r+=n==="white"?l.toUpperCase():l}}return r||"-"},ft=t=>`${t.white}+${t.black}`,we=(t,e)=>[ut(t.board)+(t.pockets?`[${ht(t.pockets)}]`:""),t.turn[0],lt(t.board,t.castlingRights),h(t.epSquare)?g(t.epSquare):"-",...t.remainingChecks?[ft(t.remainingChecks)]:[],...e?.epd?[]:[Math.max(0,Math.min(t.halfmoves,9999)),Math.max(1,Math.min(t.fullmoves,9999))]].join(" ");var ir=t=>{let e=[];for(let r=7;r>=0;r--)for(let n=0;n<8;n++){let i=n+r*8;e.push(t.has(i)?"1":"."),e.push(n<7?" ":`
`)}return e.join("")},pt=t=>be(t),sr=t=>{let e=[];for(let r=7;r>=0;r--)for(let n=0;n<8;n++){let i=n+r*8,s=t.get(i),c=s?pt(s):".";e.push(c),e.push(n<7?c.length<2?" ":"":`
`)}return e.join("")},mt=t=>g(t),or=t=>{let e=[];for(let[r,n]of t)e.push(`${g(r)}: ${Array.from(n,mt).join(" ")}`);return e.join(`
`)},Ge=(t,e,r=!1)=>{if(e<1)return 1;let n=["queen","knight","rook","bishop"];t.rules==="antichess"&&n.push("king");let i=t.ctx(),s=t.dropDests(i);if(!r&&e===1&&s.isEmpty()){let c=0;for(let[a,l]of t.allDests(i))if(c+=l.size(),t.board.pawn.has(a)){let u=o.backrank(d(t.turn));c+=l.intersect(u).size()*(n.length-1)}return c}else{let c=0;for(let[a,l]of t.allDests(i)){let u=R(a)===(t.turn==="white"?6:1)&&t.board.pawn.has(a)?n:[void 0];for(let p of l)for(let S of u){let C=t.clone(),k={from:a,to:p,promotion:S};C.play(k);let O=Ge(C,e-1,!1);r&&console.log(he(k),O),c+=O}}if(t.pockets){for(let a of q)if(t.pockets[t.turn][a]>0)for(let l of a==="pawn"?s.diff(o.backranks()):s){let u=t.clone(),p={role:a,to:l};u.play(p);let S=Ge(u,e-1,!1);r&&console.log(he(p),S),c+=S}}return c}};var bt={};G(bt,{makeSan:()=>cr,makeSanAndPlay:()=>gt,makeSanVariation:()=>ar,parseSan:()=>ur});var St=(t,e)=>{let r="";if(P(e))e.role!=="pawn"&&(r=N(e.role).toUpperCase()),r+="@"+g(e.to);else{let n=t.board.getRole(e.from);if(!n)return"--";if(n==="king"&&(t.board[t.turn].has(e.to)||Math.abs(e.to-e.from)===2))r=e.to>e.from?"O-O":"O-O-O";else{let i=t.board.occupied.has(e.to)||n==="pawn"&&w(e.from)!==w(e.to);if(n!=="pawn"){r=N(n).toUpperCase();let s;if(n==="king"?s=A(e.to).intersect(t.board.king):n==="queen"?s=H(e.to,t.board.occupied).intersect(t.board.queen):n==="rook"?s=F(e.to,t.board.occupied).intersect(t.board.rook):n==="bishop"?s=_(e.to,t.board.occupied).intersect(t.board.bishop):s=V(e.to).intersect(t.board.knight),s=s.intersect(t.board[t.turn]).without(e.from),s.nonEmpty()){let c=t.ctx();for(let a of s)t.dests(a,c).has(e.to)||(s=s.without(a));if(s.nonEmpty()){let a=!1,l=s.intersects(o.fromRank(R(e.from)));s.intersects(o.fromFile(w(e.from)))?a=!0:l=!0,l&&(r+=K[w(e.from)]),a&&(r+=Z[R(e.from)])}}}else i&&(r=K[w(e.from)]);i&&(r+="x"),r+=g(e.to),e.promotion&&(r+="="+N(e.promotion).toUpperCase())}}return r},gt=(t,e)=>{let r=St(t,e);return t.play(e),t.outcome()?.winner?r+"#":t.isCheck()?r+"+":r},ar=(t,e)=>{t=t.clone();let r=[];for(let n=0;n<e.length;n++){n!==0&&r.push(" "),t.turn==="white"?r.push(t.fullmoves,". "):n===0&&r.push(t.fullmoves,"... ");let i=St(t,e[n]);if(t.play(e[n]),r.push(i),i==="--")return r.join("");n===e.length-1&&t.outcome()?.winner?r.push("#"):t.isCheck()&&r.push("+")}return r.join("")},cr=(t,e)=>gt(t.clone(),e),ur=(t,e)=>{let r=t.ctx(),n=e.match(/^([NBRQK])?([a-h])?([1-8])?[-x]?([a-h][1-8])(?:=?([nbrqkNBRQK]))?[+#]?$/);if(!n){let p;if(e==="O-O"||e==="O-O+"||e==="O-O#"?p="h":(e==="O-O-O"||e==="O-O-O+"||e==="O-O-O#")&&(p="a"),p){let k=t.castles.rook[t.turn][p];return!h(r.king)||!h(k)||!t.dests(r.king,r).has(k)?void 0:{from:r.king,to:k}}let S=e.match(/^([pnbrqkPNBRQK])?@([a-h][1-8])[+#]?$/);if(!S)return;let C={role:S[1]?T(S[1]):"pawn",to:M(S[2])};return t.isLegal(C,r)?C:void 0}let i=n[1]?T(n[1]):"pawn",s=M(n[4]),c=n[5]?T(n[5]):void 0;if(!!c!==(i==="pawn"&&o.backranks().has(s))||c==="king"&&t.rules!=="antichess")return;let a=t.board.pieces(t.turn,i);i==="pawn"&&!n[2]?a=a.intersect(o.fromFile(w(s))):n[2]&&(a=a.intersect(o.fromFile(n[2].charCodeAt(0)-"a".charCodeAt(0)))),n[3]&&(a=a.intersect(o.fromRank(n[3].charCodeAt(0)-"1".charCodeAt(0))));let l=i==="pawn"?o.fromFile(w(s)):o.empty();a=a.intersect(l.union(X({color:d(t.turn),role:i},s,t.board.occupied)));let u;for(let p of a)if(t.dests(p,r).has(s)){if(h(u))return;u=p}if(h(u))return{from:u,to:s,promotion:c}};var xt={};G(xt,{flipDiagonal:()=>fr,flipHorizontal:()=>lr,flipVertical:()=>hr,rotate180:()=>dr,transformBoard:()=>wt,transformSetup:()=>pr});var hr=t=>t.bswap64(),lr=t=>{let e=new o(1431655765,1431655765),r=new o(858993459,858993459),n=new o(252645135,252645135);return t=t.shr64(1).intersect(e).union(t.intersect(e).shl64(1)),t=t.shr64(2).intersect(r).union(t.intersect(r).shl64(2)),t=t.shr64(4).intersect(n).union(t.intersect(n).shl64(4)),t},fr=t=>{let e=t.xor(t.shl64(28)).intersect(new o(0,252645135));return t=t.xor(e.xor(e.shr64(28))),e=t.xor(t.shl64(14)).intersect(new o(858980352,858980352)),t=t.xor(e.xor(e.shr64(14))),e=t.xor(t.shl64(7)).intersect(new o(1426085120,1426085120)),t=t.xor(e.xor(e.shr64(7))),t},dr=t=>t.rbit64(),wt=(t,e)=>{let r=y.empty();r.occupied=e(t.occupied),r.promoted=e(t.promoted);for(let n of b)r[n]=e(t[n]);for(let n of q)r[n]=e(t[n]);return r},pr=(t,e)=>({board:wt(t.board,e),pockets:t.pockets?.clone(),turn:t.turn,castlingRights:e(t.castlingRights),epSquare:h(t.epSquare)?e(o.fromSquare(t.epSquare)).first():void 0,remainingChecks:t.remainingChecks?.clone(),halfmoves:t.halfmoves,fullmoves:t.fullmoves});var qt={};G(qt,{Antichess:()=>ie,Atomic:()=>ne,Castles:()=>v,Chess:()=>$,Crazyhouse:()=>re,Horde:()=>ce,IllegalSetup:()=>te,KingOfTheHill:()=>se,Position:()=>E,PositionError:()=>m,RacingKings:()=>ae,ThreeCheck:()=>oe,castlingSide:()=>ke,defaultPosition:()=>xe,equalsIgnoreMoves:()=>et,isImpossibleCheck:()=>tt,isStandardMaterial:()=>Sr,normalizeMove:()=>Fe,setupPosition:()=>Ve});var re=class extends E{constructor(){super("crazyhouse")}reset(){super.reset(),this.pockets=U.empty()}setupUnchecked(e){super.setupUnchecked(e),this.board.promoted=e.board.promoted.intersect(e.board.occupied).diff(e.board.king).diff(e.board.pawn),this.pockets=e.pockets?e.pockets.clone():U.empty()}static default(){let e=new this;return e.reset(),e}static fromSetup(e){let r=new this;return r.setupUnchecked(e),r.validate().map(n=>r)}clone(){return super.clone()}validate(){return super.validate().chain(e=>this.pockets?.count("king")?f.err(new m("ERR_KINGS")):(this.pockets?.size()||0)+this.board.occupied.size()>64?f.err(new m("ERR_VARIANT")):f.ok(void 0))}hasInsufficientMaterial(e){return this.pockets?this.board.occupied.size()+this.pockets.size()<=3&&this.board.pawn.isEmpty()&&this.board.promoted.isEmpty()&&this.board.rooksAndQueens().isEmpty()&&this.pockets.count("pawn")<=0&&this.pockets.count("rook")<=0&&this.pockets.count("queen")<=0:super.hasInsufficientMaterial(e)}dropDests(e){let r=this.board.occupied.complement().intersect(this.pockets?.[this.turn].hasNonPawns()?o.full():this.pockets?.[this.turn].hasPawns()?o.backranks().complement():o.empty());if(e=e||this.ctx(),h(e.king)&&e.checkers.nonEmpty()){let n=e.checkers.singleSquare();return h(n)?r.intersect(z(n,e.king)):o.empty()}else return r}},ne=class extends E{constructor(){super("atomic")}static default(){let e=new this;return e.reset(),e}static fromSetup(e){let r=new this;return r.setupUnchecked(e),r.validate().map(n=>r)}clone(){return super.clone()}validate(){if(this.board.occupied.isEmpty())return f.err(new m("ERR_EMPTY"));if(this.board.king.size()>2)return f.err(new m("ERR_KINGS"));let e=this.board.kingOf(d(this.turn));return h(e)?this.kingAttackers(e,this.turn,this.board.occupied).nonEmpty()?f.err(new m("ERR_OPPOSITE_CHECK")):o.backranks().intersects(this.board.pawn)?f.err(new m("ERR_PAWNS_ON_BACKRANK")):f.ok(void 0):f.err(new m("ERR_KINGS"))}kingAttackers(e,r,n){let i=this.board.pieces(r,"king");return i.isEmpty()||A(e).intersects(i)?o.empty():super.kingAttackers(e,r,n)}playCaptureAt(e,r){super.playCaptureAt(e,r),this.board.take(e);for(let n of A(e).intersect(this.board.occupied).diff(this.board.pawn)){let i=this.board.take(n);i?.role==="rook"&&this.castles.discardRook(n),i?.role==="king"&&this.castles.discardColor(i.color)}}hasInsufficientMaterial(e){if(this.board.pieces(d(e),"king").isEmpty())return!1;if(this.board[e].diff(this.board.king).isEmpty())return!0;if(this.board[d(e)].diff(this.board.king).nonEmpty()){if(this.board.occupied.equals(this.board.bishop.union(this.board.king))){if(!this.board.bishop.intersect(this.board.white).intersects(o.darkSquares()))return!this.board.bishop.intersect(this.board.black).intersects(o.lightSquares());if(!this.board.bishop.intersect(this.board.white).intersects(o.lightSquares()))return!this.board.bishop.intersect(this.board.black).intersects(o.darkSquares())}return!1}return this.board.queen.nonEmpty()||this.board.pawn.nonEmpty()?!1:this.board.knight.union(this.board.bishop).union(this.board.rook).size()===1?!0:this.board.occupied.equals(this.board.knight.union(this.board.king))?this.board.knight.size()<=2:!1}dests(e,r){r=r||this.ctx();let n=o.empty();for(let i of me(this,e,r)){let s=this.clone();s.play({from:e,to:i});let c=s.board.kingOf(this.turn);h(c)&&(!h(s.board.kingOf(s.turn))||s.kingAttackers(c,s.turn,s.board.occupied).isEmpty())&&(n=n.with(i))}return n}isVariantEnd(){return!!this.variantOutcome()}variantOutcome(e){for(let r of b)if(this.board.pieces(r,"king").isEmpty())return{winner:d(r)}}},ie=class extends E{constructor(){super("antichess")}reset(){super.reset(),this.castles=v.empty()}setupUnchecked(e){super.setupUnchecked(e),this.castles=v.empty()}static default(){let e=new this;return e.reset(),e}static fromSetup(e){let r=new this;return r.setupUnchecked(e),r.validate().map(n=>r)}clone(){return super.clone()}validate(){return this.board.occupied.isEmpty()?f.err(new m("ERR_EMPTY")):o.backranks().intersects(this.board.pawn)?f.err(new m("ERR_PAWNS_ON_BACKRANK")):f.ok(void 0)}kingAttackers(e,r,n){return o.empty()}ctx(){let e=super.ctx();if(h(this.epSquare)&&I(d(this.turn),this.epSquare).intersects(this.board.pieces(this.turn,"pawn")))return e.mustCapture=!0,e;let r=this.board[d(this.turn)];for(let n of this.board[this.turn])if(me(this,n,e).intersects(r))return e.mustCapture=!0,e;return e}dests(e,r){r=r||this.ctx();let n=me(this,e,r),i=this.board[d(this.turn)];return n.intersect(r.mustCapture?h(this.epSquare)&&this.board.getRole(e)==="pawn"?i.with(this.epSquare):i:o.full())}hasInsufficientMaterial(e){if(this.board[e].isEmpty())return!1;if(this.board[d(e)].isEmpty())return!0;if(this.board.occupied.equals(this.board.bishop)){let r=this.board[e].intersects(o.lightSquares()),n=this.board[e].intersects(o.darkSquares()),i=this.board[d(e)].isDisjoint(o.lightSquares()),s=this.board[d(e)].isDisjoint(o.darkSquares());return r&&i||n&&s}return this.board.occupied.equals(this.board.knight)&&this.board.occupied.size()===2?this.board.white.intersects(o.lightSquares())!==this.board.black.intersects(o.darkSquares())!=(this.turn===e):!1}isVariantEnd(){return this.board[this.turn].isEmpty()}variantOutcome(e){if(e=e||this.ctx(),e.variantEnd||this.isStalemate(e))return{winner:this.turn}}},se=class extends E{constructor(){super("kingofthehill")}static default(){let e=new this;return e.reset(),e}static fromSetup(e){let r=new this;return r.setupUnchecked(e),r.validate().map(n=>r)}clone(){return super.clone()}hasInsufficientMaterial(e){return!1}isVariantEnd(){return this.board.king.intersects(o.center())}variantOutcome(e){for(let r of b)if(this.board.pieces(r,"king").intersects(o.center()))return{winner:r}}},oe=class extends E{constructor(){super("3check")}reset(){super.reset(),this.remainingChecks=D.default()}setupUnchecked(e){super.setupUnchecked(e),this.remainingChecks=e.remainingChecks?.clone()||D.default()}static default(){let e=new this;return e.reset(),e}static fromSetup(e){let r=new this;return r.setupUnchecked(e),r.validate().map(n=>r)}clone(){return super.clone()}hasInsufficientMaterial(e){return this.board.pieces(e,"king").equals(this.board[e])}isVariantEnd(){return!!this.remainingChecks&&(this.remainingChecks.white<=0||this.remainingChecks.black<=0)}variantOutcome(e){if(this.remainingChecks){for(let r of b)if(this.remainingChecks[r]<=0)return{winner:r}}}},mr=()=>{let t=y.empty();return t.occupied=new o(65535,0),t.promoted=o.empty(),t.white=new o(61680,0),t.black=new o(3855,0),t.pawn=o.empty(),t.knight=new o(6168,0),t.bishop=new o(9252,0),t.rook=new o(16962,0),t.queen=new o(129,0),t.king=new o(33024,0),t},ae=class extends E{constructor(){super("racingkings")}reset(){this.board=mr(),this.pockets=void 0,this.turn="white",this.castles=v.empty(),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}setupUnchecked(e){super.setupUnchecked(e),this.castles=v.empty()}static default(){let e=new this;return e.reset(),e}static fromSetup(e){let r=new this;return r.setupUnchecked(e),r.validate().map(n=>r)}clone(){return super.clone()}validate(){return this.isCheck()||this.board.pawn.nonEmpty()?f.err(new m("ERR_VARIANT")):super.validate()}dests(e,r){if(r=r||this.ctx(),e===r.king)return super.dests(e,r);let n=o.empty();for(let i of super.dests(e,r)){let s={from:e,to:i},c=this.clone();c.play(s),c.isCheck()||(n=n.with(i))}return n}hasInsufficientMaterial(e){return!1}isVariantEnd(){let e=o.fromRank(7),r=this.board.king.intersect(e);if(r.isEmpty())return!1;if(this.turn==="white"||r.intersects(this.board.black))return!0;let n=this.board.kingOf("black");if(h(n)){let i=this.board.occupied.without(n);for(let s of A(n).intersect(e).diff(this.board.black))if(this.kingAttackers(s,"white",i).isEmpty())return!1}return!0}variantOutcome(e){if(e?!e.variantEnd:!this.isVariantEnd())return;let r=o.fromRank(7),n=this.board.pieces("black","king").intersects(r),i=this.board.pieces("white","king").intersects(r);return n&&!i?{winner:"black"}:i&&!n?{winner:"white"}:{winner:void 0}}},kr=()=>{let t=y.empty();return t.occupied=new o(4294967295,4294901862),t.promoted=o.empty(),t.white=new o(4294967295,102),t.black=new o(0,4294901760),t.pawn=new o(4294967295,16711782),t.knight=new o(0,1107296256),t.bishop=new o(0,603979776),t.rook=new o(0,2164260864),t.queen=new o(0,134217728),t.king=new o(0,268435456),t},ce=class extends E{constructor(){super("horde")}reset(){this.board=kr(),this.pockets=void 0,this.turn="white",this.castles=v.default(),this.castles.discardColor("white"),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}static default(){let e=new this;return e.reset(),e}static fromSetup(e){let r=new this;return r.setupUnchecked(e),r.validate().map(n=>r)}clone(){return super.clone()}validate(){if(this.board.occupied.isEmpty())return f.err(new m("ERR_EMPTY"));if(this.board.king.size()!==1)return f.err(new m("ERR_KINGS"));let e=this.board.kingOf(d(this.turn));if(h(e)&&this.kingAttackers(e,this.turn,this.board.occupied).nonEmpty())return f.err(new m("ERR_OPPOSITE_CHECK"));for(let r of b){let n=this.board.pieces(r,"king").isEmpty()?o.backrank(d(r)):o.backranks();if(this.board.pieces(r,"pawn").intersects(n))return f.err(new m("ERR_PAWNS_ON_BACKRANK"))}return f.ok(void 0)}hasInsufficientMaterial(e){if(this.board.pieces(e,"king").nonEmpty())return!1;let r=k=>k==="light"?"dark":"light",n=k=>k==="light"?o.lightSquares():o.darkSquares(),i=k=>{let O=this.board.pieces(k,"bishop");return O.intersects(o.darkSquares())&&O.intersects(o.lightSquares())},s=B.fromBoard(this.board,e),c=k=>n(k).intersect(this.board.pieces(e,"bishop")).size(),a=c("light")>=1?"light":"dark",l=s.pawn+s.knight+s.rook+s.queen+Math.min(c("dark"),2)+Math.min(c("light"),2),u=B.fromBoard(this.board,d(e)),p=k=>n(k).intersect(this.board.pieces(d(e),"bishop")).size(),S=u.size(),C=k=>S-k;if(l===0)return!0;if(l>=4||(s.pawn>=1||s.queen>=1)&&l>=2||s.rook>=1&&l>=2&&!(l===2&&s.rook===1&&s.bishop===1&&C(p(a))===1))return!1;if(l===1){if(S===1)return!0;if(s.queen===1)return!(u.pawn>=1||u.rook>=1||p("light")>=2||p("dark")>=2);if(s.pawn===1){let k=this.board.pieces(e,"pawn").last(),O=this.clone();O.board.set(k,{color:e,role:"queen"});let Y=this.clone();return Y.board.set(k,{color:e,role:"knight"}),O.hasInsufficientMaterial(e)&&Y.hasInsufficientMaterial(e)}else{if(s.rook===1)return!(u.pawn>=2||u.rook>=1&&u.pawn>=1||u.rook>=1&&u.knight>=1||u.pawn>=1&&u.knight>=1);if(s.bishop===1)return!(p(r(a))>=2||p(r(a))>=1&&u.pawn>=1||u.pawn>=2);if(s.knight===1)return!(S>=4&&(u.knight>=2||u.pawn>=2||u.rook>=1&&u.knight>=1||u.rook>=1&&u.bishop>=1||u.knight>=1&&u.bishop>=1||u.rook>=1&&u.pawn>=1||u.knight>=1&&u.pawn>=1||u.bishop>=1&&u.pawn>=1||i(d(e))&&u.pawn>=1)&&(p("dark")<2||C(p("dark"))>=3)&&(p("light")<2||C(p("light"))>=3))}}else{if(l===2)return S===1?!0:s.knight===2?u.pawn+u.bishop+u.knight<1:i(e)?!(u.pawn>=1||u.bishop>=1||u.knight>=1&&u.rook+u.queen>=1):s.bishop>=1&&s.knight>=1?!(u.pawn>=1||p(r(a))>=1||C(p(a))>=3):!(u.pawn>=1&&p(r(a))>=1||u.pawn>=1&&u.knight>=1||p(r(a))>=1&&u.knight>=1||p(r(a))>=2||u.knight>=2||u.pawn>=2);if(l===3)return s.knight===2&&s.bishop===1||s.knight===3||i(e)?!1:S===1}return!0}isVariantEnd(){return this.board.white.isEmpty()||this.board.black.isEmpty()}variantOutcome(e){if(this.board.white.isEmpty())return{winner:"black"};if(this.board.black.isEmpty())return{winner:"white"}}},xe=t=>{switch(t){case"chess":return $.default();case"antichess":return ie.default();case"atomic":return ne.default();case"horde":return ce.default();case"racingkings":return ae.default();case"kingofthehill":return se.default();case"3check":return oe.default();case"crazyhouse":return re.default()}},Ve=(t,e)=>{switch(t){case"chess":return $.fromSetup(e);case"antichess":return ie.fromSetup(e);case"atomic":return ne.fromSetup(e);case"horde":return ce.fromSetup(e);case"racingkings":return ae.fromSetup(e);case"kingofthehill":return se.fromSetup(e);case"3check":return oe.fromSetup(e);case"crazyhouse":return re.fromSetup(e)}},Sr=t=>{switch(t.rules){case"chess":case"antichess":case"atomic":case"kingofthehill":case"3check":return b.every(e=>ze(t.board,e));case"crazyhouse":{let e=t.board.promoted;return e.size()+t.board.pawn.size()+(t.pockets?.count("pawn")||0)<=16&&t.board.knight.diff(e).size()+(t.pockets?.count("knight")||0)<=4&&t.board.bishop.diff(e).size()+(t.pockets?.count("bishop")||0)<=4&&t.board.rook.diff(e).size()+(t.pockets?.count("rook")||0)<=4&&t.board.queen.diff(e).size()+(t.pockets?.count("queen")||0)<=2}case"horde":return b.every(e=>t.board.pieces(e,"king").nonEmpty()?ze(t.board,e):t.board[e].size()<=36);case"racingkings":return b.every(e=>t.board.pieces(e,"knight").size()<=2&&t.board.pieces(e,"bishop").size()<=2&&t.board.pieces(e,"rook").size()<=2&&t.board.pieces(e,"queen").size()<=1)}};var Bt={};G(Bt,{Box:()=>je,ChildNode:()=>W,Node:()=>j,PgnError:()=>qe,PgnParser:()=>Ce,defaultGame:()=>Pt,defaultHeaders:()=>ye,emptyHeaders:()=>Cr,isChildNode:()=>gr,isMate:()=>Nt,isPawns:()=>Pr,makeComment:()=>Ar,makeOutcome:()=>Mt,makePgn:()=>qr,makeVariant:()=>At,parseComment:()=>Nr,parseOutcome:()=>vt,parsePgn:()=>yr,parseVariant:()=>Ot,setStartingPosition:()=>Er,startingPosition:()=>Rr,transform:()=>br,walk:()=>wr});var Pt=(t=ye)=>({headers:t(),moves:new j}),j=class{constructor(){this.children=[]}*mainline(){let e=this;for(;e.children.length;){let r=e.children[0];yield r.data,e=r}}},W=class extends j{constructor(r){super();this.data=r}},gr=t=>t instanceof W,je=class t{constructor(e){this.value=e}clone(){return new t(this.value)}},br=(t,e,r)=>{let n=new j,i=[{before:t,after:n,ctx:e}],s;for(;s=i.pop();)for(let c=0;c<s.before.children.length;c++){let a=c<s.before.children.length-1?s.ctx.clone():s.ctx,l=s.before.children[c],u=r(a,l.data,c);if(h(u)){let p=new W(u);s.after.children.push(p),i.push({before:l,after:p,ctx:a})}}return n},wr=(t,e,r)=>{let n=[{node:t,ctx:e}],i;for(;i=n.pop();)for(let s=0;s<i.node.children.length;s++){let c=s<i.node.children.length-1?i.ctx.clone():i.ctx,a=i.node.children[s];r(c,a.data,s)!==!1&&n.push({node:a,ctx:c})}},Mt=t=>t?t.winner==="white"?"1-0":t.winner==="black"?"0-1":"1/2-1/2":"*",vt=t=>t==="1-0"?{winner:"white"}:t==="0-1"?{winner:"black"}:t==="1/2-1/2"?{winner:void 0}:void 0,xr=t=>t.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),$e=t=>t.replace(/\}/g,"");var qr=t=>{let e=[],r=[];if(t.headers.size){for(let[a,l]of t.headers.entries())e.push("[",a,' "',xr(l),`"]
`);e.push(`
`)}for(let a of t.comments||[])r.push("{",$e(a),"}");let n=t.headers.get("FEN"),i=n?ge(n).unwrap(a=>(a.fullmoves-1)*2+(a.turn==="white"?0:1),a=>0):0,s=[];if(t.moves.children.length){let a=t.moves.children[Symbol.iterator]();s.push({state:0,ply:i,node:a.next().value,sidelines:a,startsVariation:!1,inVariation:!1})}let c=!0;for(;s.length;){let a=s[s.length-1];switch(a.inVariation&&(r.push(")"),a.inVariation=!1,c=!0),a.state){case 0:for(let l of a.node.data.startingComments||[])r.push("{",$e(l),"}"),c=!0;(c||a.ply%2===0)&&(r.push(Math.floor(a.ply/2)+1+(a.ply%2?"...":".")),c=!1),r.push(a.node.data.san);for(let l of a.node.data.nags||[])r.push("$"+l),c=!0;for(let l of a.node.data.comments||[])r.push("{",$e(l),"}");a.state=1;case 1:{let l=a.sidelines.next();if(l.done){if(a.node.children.length){let u=a.node.children[Symbol.iterator]();s.push({state:0,ply:a.ply+1,node:u.next().value,sidelines:u,startsVariation:!1,inVariation:!1})}a.state=2}else r.push("("),c=!0,s.push({state:0,ply:a.ply,node:l.value,sidelines:[][Symbol.iterator](),startsVariation:!0,inVariation:!1}),a.inVariation=!0;break}case 2:s.pop()}}return r.push(Mt(vt(t.headers.get("Result")))),e.push(r.join(" "),`
`),e.join("")},ye=()=>new Map([["Event","?"],["Site","?"],["Date","????.??.??"],["Round","?"],["White","?"],["Black","?"],["Result","*"]]),Cr=()=>new Map,Ct="\uFEFF",He=t=>/^\s*$/.test(t),Qe=t=>t.startsWith("%");var qe=class extends Error{},Ce=class{constructor(e,r=ye,n=1e6){this.emitGame=e;this.initHeaders=r;this.maxBudget=n;this.lineBuf=[];this.resetGame(),this.state=0}resetGame(){this.budget=this.maxBudget,this.found=!1,this.state=1,this.game=Pt(this.initHeaders),this.stack=[{parent:this.game.moves,root:!0}],this.commentBuf=[]}consumeBudget(e){if(this.budget-=e,this.budget<0)throw new qe("ERR_PGN_BUDGET")}parse(e,r){if(!(this.budget<0))try{let n=0;for(;;){let i=e.indexOf(`
`,n);if(i===-1)break;let s=i>n&&e[i-1]==="\r"?i-1:i;this.consumeBudget(i-n),this.lineBuf.push(e.slice(n,s)),n=i+1,this.handleLine()}this.consumeBudget(e.length-n),this.lineBuf.push(e.slice(n)),r?.stream||(this.handleLine(),this.emit(void 0))}catch(n){this.emit(n)}}handleLine(){let e=!0,r=this.lineBuf.join("");this.lineBuf=[];e:for(;;)switch(this.state){case 0:r.startsWith(Ct)&&(r=r.slice(Ct.length)),this.state=1;case 1:if(He(r)||Qe(r))return;this.found=!0,this.state=2;case 2:{if(Qe(r))return;let n=!0;for(;n;)n=!1,r=r.replace(/^\s*\[([A-Za-z0-9][A-Za-z0-9_+#=:-]*)\s+"((?:[^"\\]|\\"|\\\\)*)"\]/,(i,s,c)=>(this.consumeBudget(200),this.game.headers.set(s,c.replace(/\\"/g,'"').replace(/\\\\/g,"\\")),n=!0,e=!1,""));if(He(r))return;this.state=3}case 3:{if(e){if(Qe(r))return;if(He(r))return this.emit(void 0)}let n=/(?:[NBKRQ]?[a-h]?[1-8]?[-x]?[a-h][1-8](?:=?[nbrqkNBRQK])?|[pnbrqkPNBRQK]?@[a-h][1-8]|O-O-O|0-0-0|O-O|0-0)[+#]?|--|Z0|0000|@@@@|{|;|\$\d{1,4}|[?!]{1,2}|\(|\)|\*|1-0|0-1|1\/2-1\/2/g,i;for(;i=n.exec(r);){let s=this.stack[this.stack.length-1],c=i[0];if(c===";")return;if(c.startsWith("$"))this.handleNag(parseInt(c.slice(1),10));else if(c==="!")this.handleNag(1);else if(c==="?")this.handleNag(2);else if(c==="!!")this.handleNag(3);else if(c==="??")this.handleNag(4);else if(c==="!?")this.handleNag(5);else if(c==="?!")this.handleNag(6);else if(c==="1-0"||c==="0-1"||c==="1/2-1/2"||c==="*")this.stack.length===1&&c!=="*"&&this.game.headers.set("Result",c);else if(c==="(")this.consumeBudget(100),this.stack.push({parent:s.parent,root:!1});else if(c===")")this.stack.length>1&&this.stack.pop();else if(c==="{"){let a=n.lastIndex,l=r[a]===" "?a+1:a;r=r.slice(l),this.state=4;continue e}else this.consumeBudget(100),c==="Z0"||c==="0000"||c==="@@@@"?c="--":c.startsWith("0")&&(c=c.replace(/0/g,"O")),s.node&&(s.parent=s.node),s.node=new W({san:c,startingComments:s.startingComments}),s.startingComments=void 0,s.root=!1,s.parent.children.push(s.node)}return}case 4:{let n=r.indexOf("}");if(n===-1){this.commentBuf.push(r);return}else{let i=n>0&&r[n-1]===" "?n-1:n;this.commentBuf.push(r.slice(0,i)),this.handleComment(),r=r.slice(n),this.state=3,e=!1}}}}handleNag(e){this.consumeBudget(50);let r=this.stack[this.stack.length-1];r.node&&(r.node.data.nags||=[],r.node.data.nags.push(e))}handleComment(){this.consumeBudget(100);let e=this.stack[this.stack.length-1],r=this.commentBuf.join(`
`);this.commentBuf=[],e.node?(e.node.data.comments||=[],e.node.data.comments.push(r)):e.root?(this.game.comments||=[],this.game.comments.push(r)):(e.startingComments||=[],e.startingComments.push(r))}emit(e){if(this.state===4&&this.handleComment(),e)return this.emitGame(this.game,e);this.found&&this.emitGame(this.game,void 0),this.resetGame()}},yr=(t,e=ye)=>{let r=[];return new Ce(n=>r.push(n),e,NaN).parse(t),r},Ot=t=>{switch((t||"chess").toLowerCase()){case"chess":case"chess960":case"chess 960":case"standard":case"from position":case"classical":case"normal":case"fischerandom":case"fischerrandom":case"fischer random":case"wild/0":case"wild/1":case"wild/2":case"wild/3":case"wild/4":case"wild/5":case"wild/6":case"wild/7":case"wild/8":case"wild/8a":return"chess";case"crazyhouse":case"crazy house":case"house":case"zh":return"crazyhouse";case"king of the hill":case"koth":case"kingofthehill":return"kingofthehill";case"three-check":case"three check":case"threecheck":case"three check chess":case"3-check":case"3 check":case"3check":return"3check";case"antichess":case"anti chess":case"anti":return"antichess";case"atomic":case"atom":case"atomic chess":return"atomic";case"horde":case"horde chess":return"horde";case"racing kings":case"racingkings":case"racing":case"race":return"racingkings";default:return}},At=t=>{switch(t){case"chess":return;case"crazyhouse":return"Crazyhouse";case"racingkings":return"Racing Kings";case"horde":return"Horde";case"atomic":return"Atomic";case"antichess":return"Antichess";case"3check":return"Three-check";case"kingofthehill":return"King of the Hill"}},Rr=t=>{let e=Ot(t.get("Variant"));if(!e)return f.err(new m("ERR_VARIANT"));let r=t.get("FEN");return r?ge(r).chain(n=>Ve(e,n)):f.ok(xe(e))},Er=(t,e)=>{let r=At(e.rules);r?t.set("Variant",r):t.delete("Variant");let n=we(e.toSetup()),i=we(xe(e.rules).toSetup());n!==i?t.set("FEN",n):t.delete("FEN")},Pr=t=>"pawns"in t,Nt=t=>"mate"in t,yt=t=>{t=Math.max(0,t);let e=Math.floor(t/3600),r=Math.floor(t%3600/60);return t=t%3600%60,`${e}:${r.toString().padStart(2,"0")}:${t.toLocaleString("en",{minimumIntegerDigits:2,maximumFractionDigits:3})}`},Rt=t=>{switch(t){case"green":return"G";case"red":return"R";case"yellow":return"Y";case"blue":return"B"}};function Mr(t){switch(t){case"G":return"green";case"R":return"red";case"Y":return"yellow";case"B":return"blue";default:return}}var Et=t=>t.to===t.from?`${Rt(t.color)}${g(t.to)}`:`${Rt(t.color)}${g(t.from)}${g(t.to)}`,vr=t=>{let e=Mr(t.slice(0,1)),r=M(t.slice(1,3)),n=M(t.slice(3,5));if(!(!e||!h(r))){if(t.length===3)return{color:e,from:r,to:r};if(t.length===5&&h(n))return{color:e,from:r,to:n}}},Or=t=>{let e=Nt(t)?"#"+t.mate:t.pawns.toFixed(2);return h(t.depth)?e+","+t.depth:e},Ar=t=>{let e=[];h(t.text)&&e.push(t.text);let r=(t.shapes||[]).filter(i=>i.to===i.from).map(Et);r.length&&e.push(`[%csl ${r.join(",")}]`);let n=(t.shapes||[]).filter(i=>i.to!==i.from).map(Et);return n.length&&e.push(`[%cal ${n.join(",")}]`),t.evaluation&&e.push(`[%eval ${Or(t.evaluation)}]`),h(t.emt)&&e.push(`[%emt ${yt(t.emt)}]`),h(t.clock)&&e.push(`[%clk ${yt(t.clock)}]`),e.join(" ")},Nr=t=>{let e,r,n,i=[];return{text:t.replace(/\s?\[%(emt|clk)\s(\d{1,5}):(\d{1,2}):(\d{1,2}(?:\.\d{0,3})?)\]\s?/g,(c,a,l,u,p)=>{let S=parseInt(l,10)*3600+parseInt(u,10)*60+parseFloat(p);return a==="emt"?e=S:a==="clk"&&(r=S),"  "}).replace(/\s?\[%(?:csl|cal)\s([RGYB][a-h][1-8](?:[a-h][1-8])?(?:,[RGYB][a-h][1-8](?:[a-h][1-8])?)*)\]\s?/g,(c,a)=>{for(let l of a.split(","))i.push(vr(l));return"  "}).replace(/\s?\[%eval\s(?:#([+-]?\d{1,5})|([+-]?(?:\d{1,5}|\d{0,5}\.\d{1,2})))(?:,(\d{1,5}))?\]\s?/g,(c,a,l,u)=>{let p=u&&parseInt(u,10);return n=a?{mate:parseInt(a,10),depth:p}:{pawns:parseFloat(l),depth:p},"  "}).trim(),shapes:i,emt:e,clock:r,evaluation:n}};export{y as Board,Ee as CASTLING_SIDES,b as COLORS,v as Castles,$ as Chess,K as FILE_NAMES,te as IllegalSetup,U as Material,B as MaterialSide,E as Position,m as PositionError,Z as RANK_NAMES,q as ROLES,zt as RULES,D as RemainingChecks,o as SquareSet,X as attacks,z as between,_ as bishopAttacks,T as charToRole,rt as compat,kt as debug,$t as defaultSetup,h as defined,dt as fen,P as isDrop,Ze as isNormal,A as kingAttacks,J as kingCastlesTo,V as knightAttacks,g as makeSquare,he as makeUci,d as opposite,M as parseSquare,Dt as parseUci,I as pawnAttacks,Bt as pgn,H as queenAttacks,ee as ray,N as roleToChar,F as rookAttacks,bt as san,w as squareFile,R as squareRank,xt as transform,qt as variant};
